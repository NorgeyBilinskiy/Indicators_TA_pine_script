# Индикатор "Combined Rating" для TradingView (Pine Script)

## Обзор
Этот индикатор объединяет три независимых рейтинга, предоставляя трейдерам комплексное понимание поведения рынка и свечных паттернов. Каждый рейтинг отражает определённый аспект рыночной динамики:

1. **Рейтинг характера японской свечи**  
2. **Рейтинг перебития свечей**  
3. **Рейтинг наклона SMA (скользящей средней)**  

Рейтинги отображаются визуально на графике с помощью меток, размещённых над или под свечами в зависимости от контекста. Дополнительно добавлены горизонтальные линии для улучшения визуального восприятия.

---

## Описание рейтингов и методика расчёта

### 1. **Рейтинг характера японской свечи**
Оценивает значимость каждой свечи, учитывая её размер, соотношение тела к размаху и относительное положение.

- **Параметры**:
  - `atr_length`: Количество свечей для расчёта ATR.
  - `spread_ratio`: Минимальное соотношение тела свечи к размаху для значимых свечей.

- **Методика**:
  - Если размах свечи (high - low) меньше половины значения ATR, свеча считается незначимой (`rating = 0`).
  - Для значимых свечей:
    - Положительный рейтинг (`+1`): большая бычья свеча или доминирующая нижняя тень.
    - Отрицательный рейтинг (`-1`): большая медвежья свеча или доминирующая верхняя тень.

### 2. **Рейтинг перебития свечей**
Идентифицирует, когда цена закрытия свечи выходит за пределы максимума или минимума предыдущей свечи, сигнализируя о возможном подтверждении тренда.

- **Методика**:
  - `+2` — цена закрытия выше максимума предыдущей свечи.
  - `-2` — цена закрытия ниже минимума предыдущей свечи.
  - Внутридневные корректировки: рейтинг снижается до `+1` или `-1`, если цена закрытия остаётся внутри диапазона предыдущей свечи.
  - Нейтральные свечи (open = close) оцениваются по соотношению верхней и нижней тени.

### 3. **Рейтинг наклона SMA**
Оценивает направление краткосрочного тренда на основе наклона 10-периодной простой скользящей средней (SMA).

- **Методика**:
  - `+1`: SMA растёт (текущее значение больше предыдущего).
  - `-1`: SMA снижается (текущее значение меньше предыдущего).

---

## Визуальное отображение
1. **Рейтинг характера японской свечи**:
   - Метки отображаются над или под свечами, зелёный цвет для `+1`, красный для `-1`.

2. **Рейтинг перебития свечей**:
   - Метки слегка смещены от свечей, чтобы избежать наложения, тёмно-зелёный цвет для `+2`, тёмно-красный для `-2`.

3. **Рейтинг наклона SMA**:
   - Метки размещаются выше или ниже свечей, чёрный цвет для `+1` или `-1`.

4. **Границы**:
   - Горизонтальные линии, параллельные максимумам и минимумам свечей, добавлены для улучшения визуализации.

---

## Настройки
### Входные параметры
- `atr_length`: Период для расчёта ATR (по умолчанию 10).
- `spread_ratio`: Пороговое значение для значимых свечей (по умолчанию 0.5).
- `sma_length`: Период SMA (по умолчанию 10).

### Цвета
- Метки и линии имеют разные цвета для удобства восприятия.

---

## Применение
1. Добавьте скрипт на ваш график в TradingView.
2. Анализируйте комбинированные рейтинги для оценки свечных паттернов и подтверждения трендов.
3. Используйте горизонтальные линии для разделения визуальных областей и упрощения анализа.

---

## Примечания
Индикатор рекомендуется использовать вместе с другими инструментами технического анализа и не полагаться только на его данные. Перед использованием в реальной торговле протестируйте его на исторических данных.

__Не является инвестиционной рекомендацией.__

__Не является торговым сигналом.__

---
